1.安装 Docker 环境
sudo vim  /etc/apt/sources.list
## 末尾添加以下源
deb [arch=arm64] https://download.docker.com/linux/ubuntu bionic stable
#添加Docker官方GPG key
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

sudo apt update
sudo apt-get install docker-ce

2.  


工作节点：
1. 要在工作程序节点上安装并将它们添加到集群中，我们应该将环境变量K3S_URL和K3S_TOKEN(或者K3S_CLUSTER_SECRET)一起传递。K3S_TOKEN在服务器的/var/lib/rancher/k3s/server/node-token

使用安装脚本+参数：
export K3S_URL=https://172.16.114.72:6443 
export K3S_TOKEN=K106778ca1f48aa6e990554651f89ac21da4a1669153c01cf82950c6d0a6daf8614::server:b6cf3b5ccc68adb487d9be4a9dab51c2
sh k3s_install.sh

 
-- 在自动下载安装的过程中存在网络问题. 下载k3s的二进制可执行文件
下载k3s二进制可执行文件(地址可以根据sh install.sh的命令行打印显示获取)
wget https://github.com/rancher/k3s/releases/download/v0.10.2/k3s
wget https://github.com/rancher/k3s/releases/download/v1.18.2+k3s1/k3s-arm64
之后上传此Binary到服务器端的 /usr/local/bin/k3s，并赋予可执行属性：
chmod +x /usr/local/bin/k3s


安装完成后，我们需要调整下K3S的服务配置文件，以将K3S的默认容器引擎从Containerd切换到Docker。
修改K3S服务的配置文件：
vim /etc/systemd/system/multi-user.target.wants/k3s-agent.service
需要修改ExecStart的值，将其修改为：
/usr/local/bin/k3s agent --docker

保存退出，执行命令重新加载新的服务配置文件:
sudo systemctl daemon-reload
sudo systemctl restart docker 
sudo systemctl restart k3s-agent.service











-----------------如果使用默认的容器运行环境--------
k3s默认没有使用Docker作为容器运行环境，而是使用了内置的contained，可以使用crictl子命令与CRI交互。
如果习惯使用docker命令行可以设置如下别名:
sudo vim ~/.bashrc
#在最后添加：
alias sudo='sudo '
alias docker='k3s crictl'
#重新执行刚修改的初始化文档
source ~/.bashrc


重启K3S服务：  systemctl restart k3s-agent.service
 



--工作节点上的docker镜像问题
--pause镜像的问题， 针对arm64架构的node， 必须要单独指定下载 arm64版本的， 否则网络错误， 不能形成拓扑结构

sudo docker rmi rancher/pause:3.1 -f
sudo docker pull rancher/pause@sha256:2aac966ece8906a535395f92bb25f0e8e21dac737df75b381e8f9bdd3ed56528
sudo docker tag  1 rancher/rancher-agent:v2.4.3

sudo docker pull rancher/rancher-agent@sha256:880b0b0914c45cd98bc0977414e8e553c375530b1bac03d9c9eebed0b9dcdead
sudo docker rmi rancher/rancher-agent:v2.4.3 -f
sudo docker tag  2 rancher/rancher-agent:v2.4.3

sudo docker pull rancher/klipper-lb:v0.1.2@sha256:92528c2c86bc2f6abadeb241c9ec09165e7c44662381b6721578eff4ad1691d3
sudo docker rmi rancher/klipper-lb:v0.1.2 -f
sudo docker tag  3 rancher/klipper-lb:v0.1.2





