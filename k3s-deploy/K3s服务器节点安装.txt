1.安装 Docker 环境

2. 安装 Rancher Server
Rancher Server 已经打包成了Docker 镜像
运行命令：
docker run -d -v /data/docker/rancher-server/var/lib/rancher/:/var/lib/rancher/ --restart=unless-stopped --name rancher-server -p 80:80 -p 443:443 rancher/rancher:stable

-- 如果不想占用宿主机的80/443端口， 可以修改为自定义的端口
如： docker run -d -v /data/docker/rancher-server/var/lib/rancher/:/var/lib/rancher/ --restart=unless-stopped --name rancher-server -p 9080:80 -p 9443:443 rancher/rancher:stable

3.容器启动后， 访问 https://xx.xx.xx.xx:9443/, 进入Rancher Server 主界面

4. 创建集群 ， 选择导入集群
  完成后我们会得到导入K3S集群所需的命令，请保存好第三条命令以备后 
curl --insecure -sfL https://172.16.114.72:9443/v3/import/l8wj8zqw7c2bwlsp5hfdj9mg9697r9n9c9lmzzqtfww4wlz6kwlqtt.yaml | k3s kubectl apply -f -

 
5. 安装 k3s集群
使用一键脚本即可完成K3S环境的安装：
sh k3s_install.sh

-- 在自动下载安装的过程中存在网络问题. 下载k3s的二进制可执行文件
下载k3s二进制可执行文件(地址可以根据sh install.sh的命令行打印显示获取)
wget https://github.com/rancher/k3s/releases/download/v0.10.2/k3s
wget https://github.com/rancher/k3s/releases/download/v1.18.2+k3s1/k3s-arm64
之后上传此Binary到服务器端的 /usr/local/bin/k3s，并赋予可执行属性：
chmod +x /usr/local/bin/k3s


安装完成后，我们需要调整下K3S的服务配置文件，以将K3S的默认容器引擎从Containerd切换到Docker。
修改K3S服务的配置文件：
vim /etc/systemd/system/multi-user.target.wants/k3s.service
需要修改ExecStart的值，将其修改为：
/usr/local/bin/k3s server --docker --no-deploy traefik

保存退出，执行命令重新加载新的服务配置文件：systemctl daemon-reload
重启K3S服务：  service k3s restart
通过命令确认K3S集群是否就绪：  k3s kubectl get node

-- 可能遇到Docker启动失败的问题：
kubelet 使用的cgroupdriver和docker使用的不一样的问题
修改文件： /etc/systemd/system/multi-user.target.wants/docker.service
          /etc/docker/daemon.json  
  两处只需要设置一个就行


6. 在服务器上运行步骤4得到的导入集群的命令， 即可将Rancher Server和 k3s关联起来

-------- 服务器就准备好了
 


